"use strict";function Item(a){this.selected=!1,angular.extend(this,a)}var app=angular.module("BEApp",["ui.router","BEApp.directives","BEApp.filters","BEApp.services"]);app.config(["$stateProvider","$urlRouterProvider","$httpProvider",function(a,b,c){b.otherwise("/"),a.state("main",{url:"/",templateUrl:"views/main.html",controller:"MainCtrl"}).state("block",{url:"/block/:block_id",templateUrl:"views/block.html",controller:"BlockCtrl"}).state("tx",{url:"/block/:block_id/tx/:tx_id",templateUrl:"views/tx.html",controller:"TxCtrl"}),c.defaults.useXDomain=!0,delete c.defaults.headers.common["X-Requested-With"]}]),angular.module("BEApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]).controller("BlockCtrl",["$scope","$stateParams","items",function(a,b,c){c.all.forEach(function(c){c.id===b.blockId&&(a.block=c)}),a.blockId=b.blockId,a.tx=a.block.l_tx,a.showingId=null,a.showing=!1,a.toogleShowingTx=function(b){a.showingId!=b?(a.showingId=b,a.showing=!0):(a.showingId=null,a.showing=!1)}}]).controller("TxCtrl",["$scope",function(a){a.tx={id:145698,size:258,relayed_by:"64.179.201.80"}}]).controller("AppController",["$scope","items","scroll",function(a,b,c){a.items=b,a.refresh=function(){},a.handleSpace=function(){c.pageDown()||b.next()},a.$watch("items.selectedIdx",function(a){null!==a&&c.toCurrent()})}]).controller("NavBarController",["$stateParams","items",function(){}]);var directives=angular.module("BEApp.directives",[]);directives.directive("keyDown",function(){return function(a,b,c){b.bind("keyDown",function(b){switch(b.keyCode){case 34:case 39:case 40:case 74:return a.$apply(c.wDown);case 32:return b.preventDefault(),a.$apply(c.wSpace);case 33:case 37:case 38:case 75:return a.$apply(c.wUp)}})}}),directives.directive("wContent",function(){return{restrict:"E",template:'<iframe src="post-content.html" seamless class="post-content"></iframe>',link:function(a,b,c){var d=b.find("iframe")[0].contentWindow;a.$watch(c.src,function(a){d.postMessage({type:"loadContent",content:a},"*")}),window.addEventListener("message",function(a){if("openUrl"==a.data.type){var b=angular.element('<a href="'+a.data.url+'" target="_blank"></a>')[0],a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,b),b.dispatchEvent(a)}},!1)}}});var services=angular.module("BEApp.services",[]);services.factory("items",["$http",function(a){var b="http://blockchain.info/q/latesthash",c={all:[],filtered:[],selected:null,selectedIdx:null,prevHash:null,dataToItem:function(a){var b={hash:a.hash,id:a.block_index,prev_hash:a.prev_block,bits:a.bits,relayed_by:a.relayed_by,height:a.height,n_tx:a.n_tx,l_tx:{}};return a.tx.forEach(function(a){b.l_tx[a.hash]={hash:a.hash,id:a.tx_index,relayed_by:a.relayed_by,size:a.size,"in":[],out:[]};try{var c=[];a.inputs.forEach(function(d){c.push({addr:d.prev_out.addr,n:d.prev_out.n,id:d.prev_out.tx_index,value:d.prev_out.value}),b.l_tx[a.hash].in=c})}catch(d){console.log(d)}a.out.forEach(function(c){b.l_tx[a.hash].out.push({addr:c.addr,n:c.n,value:c.value})})}),new Item(b)},getLocalUrl:function(a){return"/json/blocks/"+a+".json"},getItemFromLocalStore:function(){for(var b=0;1>b;++b)a.get(c.getLocalUrl("0000000000000002e4607cdf63b538c9dfe92d5fb9b61ced4efed621e8b5e651")).then(function(a){c.all.push(c.dataToItem(a.data)),console.log(a.data.hash)}),a.get(c.getLocalUrl("000000000000000380df4545064963c898a30d8c743b15c563d03c1b5d4670b3")).then(function(a){c.all.push(c.dataToItem(a.data)),console.log(a.data.hash)}),a.get(c.getLocalUrl("0000000000000005f478a81a12a25b7a562f2f75d1088727aebb1170d4da3cc9")).then(function(a){c.all.push(c.dataToItem(a.data)),console.log(a.data.hash)});c.filtered=c.all},getRemoteUrl:function(a){return"http://blockchain.info/rawblock/"+a+"?format=json&cors=true"},get5ItemsfromRemoteStore:function(){},refreshItems:function(){a.get(b).then()},prev:function(){c.hasPrev()&&c.selectItem(c.selected?c.selectedIdx-1:0)},next:function(){c.hasNext()&&c.selectItem(c.selected?c.selectedIdx+1:0)},hasPrev:function(){return c.selected?c.selectedIdx>0:!0},hasNext:function(){return c.selected?c.selectedIdx>0:!0},selectItem:function(a){c.selected&&(c.selected.selected=!1),c.selected=c.filtered[a],c.selectedIdx=a,c.selected.selected=!0},filterBy:function(a,b){c.filtered=c.all.filtered(function(c){return c[a]===b}),c.reindexSelectedItem()},clearFilter:function(){c.filtered=c.all,c.reindexSelectedItem()},reindexSelectedItem:function(){if(c.selected){var a=c.filtered.indexOf(c.selected);-1===a?(c.selected&&(c.selected.selected=!1),c.selected=null,c.selectedIdx=null):(c.selectedIdx=a,c.selected.selected=!0)}}};return c.prevHash||(c.prevHash="0000000000000002e4607cdf63b538c9dfe92d5fb9b61ced4efed621e8b5e651"),c.getItemFromLocalStore(),c}]),services.factory("scroll",["$timeout",function(a){return{pageDown:function(){var a=$(".entry.active").height()+60,b=$(window).height(),c=$(".entries").scrollTop(),d=c+b;return a>d?($(".entries").scrollTop(d),!0):!1},toCurrent:function(){a(function(){var a=$(".summaries").scrollTop(),b=$(".summary.active").offset().top-60;$(".summaries").animate({scrollTop:a+b},200),$(".entries article.active")[0].scrollIntoView()},0,!1)}}}]);var filters=angular.module("BEApp.filters",[]);